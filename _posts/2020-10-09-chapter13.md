---
title: النماذج الخطية
show_title: true
chapter_number: 13
chapter_text: الفصل الثالث عشر
chapter_lessons: [[0, 'مقدمة'], [1, 'التنبؤ بالإكراميات'], [2, 'ضبط النموذج الخطي بإستخدام النزول الإشتقاقي'], [3, 'الإنحدار الخطي المتعدد'], [4, 'المربعات الصغرى - منظور هندسي'], [5, 'تطبيق عملي للإنحدار الخطي']]
chapter_sublessons: [
    [],
    [['تعريف نموذج خطي بسيط', 'توقع النموذج الخطي']],
    [['ضبط النموذج الخطي مع النزول الإشتقاقي', 'ملاحظة عن إستخدام العلاقات'],'مشتقة خسارة الخطأ التربيعي المتوسط MSE', 'تطبيق النزول الإشتقاقي'],
    ['خسارة الخطأ التربيعي المتوسط وإنحدارها', 'ضبط النموذج مع النزول الإشتقاقي', 'الرسم البياني لتنبؤاتنا', 'استخدام كامل البيانات', 'ملخص الإنحدار الخطي المتعدد'],
    ['المربعات الصغرى: النموذج الثابت', 'المربعات الصغرى: نموذج خطي بسيط', 'الفكره الهندسيه', 'الجبر الخطي', 'انهاء الدراسه', 'عندما تعتمد المتغيرات خطياً', 'طريقتين للتفكير'],
    ['نظره عامه على البيانات', 'تنظيف البيانات', 'فصل بيانات التدريب والإختبار', 'استكشاف البيانات وتصويرها', 'النماذج الخطيه البسيطه', 'تحويل المتغيرات', 'نموذج الإنحدار الخطي المتعدد', 'تقييم نموذجنا'],
]
layout: default
---

## مقدمة

الآن، بعد ان تعلمنا بشكل عام ادوات لضبط النماذج مع دوال التكلفه، نتحول لطرق تحسين النموذج. للتبسيط، في السابق حددنا عملنا على النموذج الثابت: نموذجنا فقط يتوقع رقم واحد.

ولكن، إعطاء نموذج كهذا للمضيف لن يرضيه. يود المضيف ان يوضح انه حصل على معلومات اكثر نسبة الإكراميه من الطاولات التي خدمها. لماذا لا نستخدم بياناته الأخرى، مثلاً حجم العملاء في الطاوله ومجموع الفاتوره، لغرض جعل النموذج اكثر فائدة.

في هذا الفصل سنتعرف على النماذج الخطية والذي يسمح لنا بإستخدام جميع البيانات التي لدينا لإجراء توقعات. النماذج الخطية لا تستخدم بنطاقٍ واسع فقط، بل ايضاً لديها اسس نظريه غنية بالمعلومات التي تجعلنا نفهم ادوات مستقبليه للنماذج. سنتعرف على نموذج الإنحدار الخطي البسيط الذي يستخدم متغير واحد، سنتعلم كيف يستخدم النزول الإشتقاقي لضبط النموذج، واخيراً التوسع في النموذج وإضافة المزيد من المتغيرات له.

## التنبؤ بالإكراميات

سابقاً، تعاملنا مع بيانات تحتوي على سطر واحد لكل طاولة قام المضيف بخدمتها لمدة اسبوع. المضيف قام بجمع البيانات للقيام بالتوقع بقيمة الإكرامية التي سيحصل عليها في المستقبل:

```python
tips = sns.load_dataset('tips')
tips.head()
```

|**size**|**time**|**day**|**smoker**|**sex**|**tip**|**total\_bill**| 
|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:
|2|Dinner|Sun|No|Female|1.01|16.99|0
|3|Dinner|Sun|No|Male|1.66|10.34|1
|3|Dinner|Sun|No|Male|3.5|21.01|2
|2|Dinner|Sun|No|Male|3.31|23.68|3
|4|Dinner|Sun|No|Female|3.61|24.59|4

<br>
```python
sns.distplot(tips['tip'], bins=25);
```

<p align="center"> 
<img src='{{ site.baseurl }}/img/chapter13/linear_tips_3_0.png'>
</p>

كما تحدثنا سابقاً، اذا اخترنا النموذج الثابت ودالة الخطأ التربيعي المتوسط، فأن نموذجنا سيتوقع متوسط الإكراميات:

```python
np.mean(tips['tip'])
```

```ruby
2.9982786885245902
```

يعني ذلك ان عندما يأتي مجموعة من الزبائن للمضيف ثم يسألنا المضيف عن مجموعه الإكرامية التي سيحصل عليها، فسنجيب عليه "حوالي $ \\$3 $"، اياً كان عدد الزبائن ومجموع الفاتوره.

ولكن، عند التحقق من باقي المتغيرات في البيانات، يمكننا ان نقوم بتوقعات دقيقه إذا اضفنا تلك المتغيرات للنموذج. مثلاً، الرسم البياني التالي يوضح مجموع الإكراميه مقارنة بمبلغ الفاتورة ويظهر العلاقة الإيجابية بينهما:

```python
sns.lmplot(x='total_bill', y='tip', data=tips, fit_reg=False)
plt.title('Tip amount vs. Total Bill')
plt.xlabel('Total Bill')
plt.ylabel('Tip Amount');
```

<p align="center"> 
<img src='{{ site.baseurl }}/img/chapter13/linear_tips_7_0.png'>
</p>

على الرغم ان متوسط الإكراميه هو $ \\$3 $، اذا كانت الطاولة طلبت ما مجموعه $ \\$40 $ من الوجبات فأننا متأكدين ان المضيف سيحصل على اكثر من $ \\$3 $ كأكرامية. لذا، نريد التعديل في نموذجنا ليتمكن من التوقع بناءًا على متغيرات في بياناتنا بدلاً من توقع متوسط الإكرامية. للقيام بذلك، سنستخدم النموذج الخطي بدلاً من الثابت.

لنراجع أولاً الأدوات التي لدينا لبناء النموذج والتوقع وتعريف بعض الرموز الجديده لنتمكن بشكل افضل من تمثيل العمليات الرياضيه الإضافيه في النموذج الخطي.

### تعريف نموذج خطي بسيط

نحن مهتمون بتوقع قيمة الإكراميه بناءًا على مجموع الفاتوره. لنجعل $ y $ تمثل مجموع الإكراميه، المتغير الذي نريد ان يتوقعه النموذج. و $ x $ تمثل مجموع الفاتوره، المتغير الذي نريد استخدامه للتوقع.

نقوم بتعريف النموذج الخطي $ f_\boldsymbol\theta^* $ الذي يعتمد على $ x $:

$$ f_\boldsymbol\theta^* (x) = \theta_1^* x + \theta_0^* $$

نتعامل مع $ f_\boldsymbol\theta^* (x) $ على انها الدالة التي أنشأت البيانات.

تفترض $ f_\boldsymbol\theta^* (x) $ ان $ y $ لديها علاقه خطيه كامله مع $ x $. ولكن، في بياناتنا لا يظهر لنا خط مستقيم بسبب وجود بعض البيانات العشوائية المزعجه $ \epsilon $. رياضياً، نأخذ بعين الإعتبار هذه المشكله بإضافة المصطلح:

$$ y = f_\boldsymbol\theta^* (x) + \epsilon $$

أذا كانت الإفتراضيه ان $ y $ لديها علاقخ خطية كامله مع $ x $، وتمكنا بطريقة ما من توقع القيمة الصحيحه ل $ \theta_1^* $ و $ \theta_0^* $، وبشكل غير اعتيادي لم يكنا لدينا أي عشوائية في البيانات، سنتمكن من التوقع بشكل دقيق قيمة الإكرامية التي سيحصل عليها المضيف من جميع الزبائن، وبشكل دائم. بالطبع، لا يمكننا تلبية جميع المعايير في الحياه الواقعية. بدلاً من ذلك، نتوقع $ \theta_1^* $ و $ \theta_0^* $ بإستخدام البيانات لجعل توقعاتنا اقرب دقه للواقع.

#### توقع النموذج الخطي

بما أننا لا نستطيع إيجاد قيمة $ \theta_1^* $ و $ \theta_0^* $ بشكل دقيق، سنفترض ان بياناتنا تتوقع قيمة هذه المتغيرات. نشير للتوقعات ب $ \theta_1 $ و $ \theta_0 $، وتوقعنا الذي يتم ضبطه بالنموذج ب $ \hat{\theta_1} $ و $ \hat{\theta_0} $، و النموذج:

$$ f_\boldsymbol\theta (x) = \theta_1 x + \theta_0 $$

أحياناً سترى $ h(x) $ بدلاً من $ f_\hat{\boldsymbol\theta} (x) $؛ ال $ h $ تعني الفرضية *Hypothesis*، كون $ f_\hat{\boldsymbol\theta} (x) $ هي فرضيتنا ل $ f_{\boldsymbol\theta^*} (x) $.

من أجل تحديد قيمة $ \hat{\theta_1} $ و $ \hat{\theta_0} $، نقوم بإختيار دالة تكلفة وتقليلها بإستخدام النزول الإشتقاقي.

## ضبط النموذج الخطي بإستخدام النزول الإشتقاقي

نريد ضبط نموذج خطي يتنبأ بقيمة الإكراميه من مجموع الفاتوره:

$$ f_\boldsymbol\theta (x) = \theta_1 x + \theta_0 $$

ولتسحين قيم $ \theta_1 $ و $ \theta_0 $، نحتاج أولاً لإختيار دالة خسارة. سنختار دالة خسارة الخطأ التربيعي المتوسط MSE:

$$ \begin{split}
\begin{aligned}
L(\boldsymbol\theta, \textbf{x}, \textbf{y})
&= \frac{1}{n} \sum_{i = 1}^{n}(y_i - f_\boldsymbol\theta (x_i))^2\\
\end{aligned}
\end{split} $$

لاحظ اننا عدلنا على دالة الخساره لتوضيح إضافتنا لمتغير في النموذج. الآن، $ \textbf{x} $ هي مصفوفه أحادية البعد تحتوي على جميع الفواتير، و $ \textbf{y} $ هي مصفوفة أحادية البعد تحتوي على قيمة كل إكراميه، و $ \boldsymbol\theta $ هي مصفوفة تحتوي على التالي: $ \boldsymbol\theta = [ \theta_1, \theta_0 ] $.

يطلق على إستخدام النموذج الخطي مع دالة خسارة الخطأ التربيعي المتوسط بإسم الإنحدار الخطي للمربعات الصغرى Least-squares Linear Regression. يمكننا استخدام النزول الإشتقاقي لإيجاد قيمة $ \boldsymbol\theta $ التي تقلل الخساره. [📝][LinearLeastSquares]

#### ملاحظة عن إستخدام العلاقات

اذا سبق أن رأيت الإنحدار الخطي للمربعات الصغرى، قد تلاحظ اننا نستطيع حساب معامل الإرتباط وإستخدامه لتحديد قيمة $ \theta_1 $ و $ \theta_0 $. هذه طريقة اسهل واسرع للحساب بدلاً من إستخدام النزول الإشتقاقي في أي معادله، تماماً كما يكون اسهل لنا حساب المتوسط بدلاً من حساب النزول الإشتقاقي لضبط النموذج الثابت. على أية حال، سنستخدم النزول الإشتقاقي لأنها طريقة عامله لتقليل الخساره وستعمل معنا لاحقاً عندما نتعرف على نماذج لا يمكن حساب خسارتها إحصائياً. بالأصح، في كثير من المشاكل في العالم الحقيقي، سنستخدم النزول الإشتقاقي حتى ولو كانت هناك طرق إحصائيه تحليله لأن حسابها يأخذ وقتاً اطول من النزول الإشتقاقي، خاصة عندما تكون البيانات ذات حجم كبير.

### مشتقة خسارة الخطأ التربيعي المتوسط MSE

لإستخدام النزول الإشتقاقي، نحتاج لحساب مشتقة خسارة الخطأ التربيعي المتوسط بالنسبة ل $ \boldsymbol\theta $. الآن بما ان $ \boldsymbol\theta $ عبارة عن مصفوفه ذات طول 2 وليست قيمة عددية مدرجة Scalar، و $ \nabla_{\boldsymbol\theta} L(\boldsymbol\theta, \textbf{x}, \textbf{y}) $ ايضاً مصفوفه من الحجم 2. [📝][Scalar]

$$ \begin{split}
\begin{aligned}
\nabla_{\boldsymbol\theta} L(\boldsymbol\theta, \textbf{x}, \textbf{y})
&= \nabla_{\boldsymbol\theta} \left[ \frac{1}{n} \sum_{i = 1}^{n}(y_i - f_\boldsymbol\theta (x_i))^2 \right] \\
&= \frac{1}{n} \sum_{i = 1}^{n}2 (y_i - f_\boldsymbol\theta (x_i))(- \nabla_{\boldsymbol\theta} f_\boldsymbol\theta (x_i))\\
&= -\frac{2}{n} \sum_{i = 1}^{n}(y_i - f_\boldsymbol\theta (x_i))(\nabla_{\boldsymbol\theta} f_\boldsymbol\theta (x_i))\\
\end{aligned}
\end{split} $$

نعرف ان:

$$ f_\boldsymbol\theta (x) = \theta_1 x + \theta_0 $$

نريد حساب قيمة $ \nabla_{\boldsymbol\theta} f_\boldsymbol\theta (x_i) $ والتي هي مصفوفه طولها 2:

$$ \begin{split}
\begin{aligned}
\nabla_{\boldsymbol\theta} f_\boldsymbol\theta (x_i)
&= \begin{bmatrix}
     \frac{\partial}{\partial \theta_0} f_\boldsymbol\theta (x_i)\\
     \frac{\partial}{\partial \theta_1} f_\boldsymbol\theta (x_i)
   \end{bmatrix} \\
&= \begin{bmatrix}
     \frac{\partial}{\partial \theta_0} [\theta_1 x_i + \theta_0]\\
     \frac{\partial}{\partial \theta_1} [\theta_1 x_i + \theta_0]
   \end{bmatrix} \\
&= \begin{bmatrix}
     1 \\
     x_i
   \end{bmatrix} \\
\end{aligned}
\end{split} $$

اخيراً، نعوضها في معادلتنا الأساسيه لنحصل على التالي:

$$ \begin{split}
\begin{aligned}
\nabla_{\boldsymbol\theta} L(\theta, \textbf{x}, \textbf{y})
&= -\frac{2}{n} \sum_{i = 1}^{n}(y_i - f_\boldsymbol\theta (x_i))(\nabla_{\boldsymbol\theta} f_\boldsymbol\theta (x_i))\\
&= -\frac{2}{n} \sum_{i = 1}^{n} (y_i - f_\boldsymbol\theta (x_i)) \begin{bmatrix} 1 \\ x_i \end{bmatrix} \\
&= -\frac{2}{n} \sum_{i = 1}^{n} \begin{bmatrix}
    (y_i - f_\boldsymbol\theta (x_i)) \\
    (y_i - f_\boldsymbol\theta (x_i)) x_i
    \end{bmatrix} \\
\end{aligned}
\end{split} $$

هذه مصفوفة من طولها 2 كون $ (y_i - f_\boldsymbol\theta (x_i)) $ قيمة عددية مدرجه.

### تطبيق النزول الإشتقاقي

## الإنحدار الخطي المتعدد

### خسارة الخطأ التربيعي المتوسط وإنحدارها

### ضبط النموذج مع النزول الإشتقاقي

### الرسم البياني لتنبؤاتنا

### استخدام كامل البيانات

### ملخص الإنحدار الخطي المتعدد

## المربعات الصغرى - منظور هندسي

### المربعات الصغرى: النموذج الثابت

### المربعات الصغرى: نموذج خطي بسيط

### الفكره الهندسيه

### الجبر الخطي

### انهاء الدراسه

### عندما تعتمد المتغيرات خطياً

### طريقتين للتفكير

## تطبيق عملي للإنحدار الخطي

### نظره عامه على البيانات

### تنظيف البيانات

### فصل بيانات التدريب والإختبار

### استكشاف البيانات وتصويرها

### النماذج الخطيه البسيطه

### تحويل المتغيرات

### نموذج الإنحدار الخطي المتعدد

### تقييم نموذجنا




[LinearLeastSquares]: https://towardsdatascience.com/linear-regression-using-least-squares-a4c3456e8570
[Scalar]: https://www.youtube.com/watch?v=rcDXQ-5H8mk
