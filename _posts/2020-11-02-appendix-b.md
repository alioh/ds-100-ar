---
title: مراجعة الاستدلال الإحصائي
show_title: true
chapter_text: ""
show_index: true
chapter_number: 2
chapter_lessons: [[0, 'مقدمة'], [1, 'اختبار الفرضيات و مجال الثقة'], [2, 'اختبارات الفرضية'], [3, 'التصميم'], [4, 'اختبار الإحصائية'], [5, 'اجراء اختبار التبادل'], [6, 'تمهيد فترات الثقة'], [7, 'ملخص مراجعة الاستدلال الإحصائي']]
layout: default
---

## مقدمة

هذا الملحق يستعرض الإستدلال بإستخدام اختبارات التبادل والتمهيد. تم التحدث عن هذة المواضيع في الفصل [12](https://www.inferentialthinking.com/chapters/12/Comparing_Two_Samples.html) و [13](https://www.inferentialthinking.com/chapters/13/Estimation.html) من كتاب داتا 8.

على الرغم أن علماء البيانات يعملون على عينات من البيانات، إلا اننا دائماً مهتمين بالتعميم على المجمع الإحصائي التي أتت منة البيانات. هذا الملحق يتحدث عن طرق إجراء *الاستدلال الإحصائي Statistical Inference*، طريقة لبناء استنتاجات عن كل المجتمع الإحصائي بإستخدام البيانات.

نعتمد في الاستدلال الإحصائي بشكل عام على طريقتين: إختبار الفرضيات ومجالات الثقة. في الماضي القريب، اعتمدت هذة الأساليب بشكل كبير على النظرية العادية، والتي هي فرع من الإحصائيات التي تتطلب افتراضيات اساسية عن المجتمع الإحصائي. اليوم، التطور السريع والذي وفر حوسبة قوية أمكن من إيجاد طرق جديدة من الأساليب والتي تعتمد على *إعادة التشكيل Resampling* والتي تعمم على أنواع كثيره من المجتمعات الإحصائية.
## اختبار الفرضيات و مجال الثقة

سيكون هذا الملحق مراجعة بسيطة لإختبار الفرضيات بإستخدام التمهيد واختبارات التبادل. نتوقع معرفة بهذة العناوين كونها تم التحدث بشكل كبير عنها في كتاب التفكير الحسابي والاستنتاجي، الكتاب الخاس بمادة داتا 8. للحصول على معلومات وشرح أكثر عن المواضيع التي سيتم شرحها هنا، أطلع على الفصل [11](https://www.inferentialthinking.com/chapters/11/Testing_Hypotheses)، [12](https://www.inferentialthinking.com/chapters/12/Comparing_Two_Samples) و [13](https://www.inferentialthinking.com/chapters/13/Estimation) من كتاب التفكير الحسابي والاستنتاجي.

## اختبارات الفرضية

عند تطبيق مفاهيم علم البيانات في مختلف المجالات، عادة ما نواجة اسئلة عامة. مثلاً، هل شرب القهوة يسبب حرام النوم؟ هل تتسبب السيارات ذاتية القيادة بحوادث أكثر من السيارات غير ذاتية القيادة؟ هل الدواء `X` يساعد على علاج الإلتهابات الرئوية؟ للمساعدة في الإجابة على هذة الأسئلة، نستخدم اختبارات الفرضية لإيجاد نتائج علمية بناءًا على الأدلة والبيانات التي إطلعنا عليها.

بما أن عملية جمع البيانات عادة ما تحتوي على خطوات غير دقيقة، عادة ما نكون غير متأكدين من الانماط الموجودة في تلك البيانات إن كانت بسبب التشويش أو بسبب بيانات حقيقة عن الإلتهاب الرئوي. تساعدنا اختبارات الفرضية على تحديد ما اذا كان النمط في البيانات حدث بسبب التقلبات العشوائية في طريقة جمعنا للبيانات.

سنبدأ بمثال لإستكشاف اختبارات الفرضية. الجدول `baby` يحتوي على بيانات أوزان الأطفال وقت الولادة. تم تسجيل وزن المواليد بالأونصة وما إذا كانت الأم تدخن أثناء حملها.

> لتحميل البيانات baby.csv [اضغط هنا]({{ site.baseurl }}/files/chapter17/baby.csv).

```python
import pandas as pd
import numpy as np

baby = pd.read_csv('baby.csv')
baby = baby.loc[:, ["Birth Weight", "Maternal Smoker"]]

baby
```

**Maternal Smoker**|**Birth Weight**| 
:-----:|:-----:|:-----:
FALSE|120|0
FALSE|113|1
TRUE|128|2
...|...|...
TRUE|130|1171
FALSE|125|1172
FALSE|117|1173

```ruby
1174 rows × 2 columns
```
## التصميم

نريد أن نرى ما إذا كان تدخين الأم له علاقة بوزن المولود. لإعداد الإختبار لفرضيتنا، يمكننا تمثيل وجهتي النظر العامة كالتالي:

- **فرضية العدم Null hypothesis**: في المجتمع الإحصائي، يكون التوزيع للبيانات لأوزان المواليد للأمهات غير المدخنات مساوي للتوزيع لأوزان المواليد من الأمهات المدخنات. الفرق الذي يحدث في البيانات كان بالصدفة.

- **الفرضية البديلة Alternative hypothesis**: في المجتمع الإحصائي، متوسط الوزن أثناء الولادة للمواليد من الأمهات المدخنات كان أقل من المواليد من أمهات غير مدخنات.

هدفنا الرئيسي هو إتخاذ قرار بين هذة الفرضيات. نقطة مهمه يجب الإنتباه لها وهي أننا أوجدنا هذة الفرضيات بناءًا على *المتغيرات Parameters* من البيانات وليس من تجاربنا. مثلاً، يجب أن لا نقوم ببناء فرضية العدم مثل "وزن مواليد الأمهات المدخنات سيكون مساوي لوزن مواليد الأمهات غير المدخنات"، نظرًا لوجود تبيان بشكل طبيعي في النتائج.

تؤكد فرضية العدم أن إذا كانت النتائج تظهر عكس ما توقعته الفرضية، فأن ذلك الفرق كان بمحض الصدفة. وبشكل غير رسمي، تقول الفرضية البديلة أن الفرق والإختلاف التي أطلعت عليه "حقيقي".

يجب أن نلقي نظرة أكثر على شكل فرضيتنا البديلة. في الوضع الحالي، لاحظ أننا سنرفض فرضية العدم إذا كان وزن المواليد من الأمهات المدخنات أقل بشكل واضح وكبير من أوزان المواليد من الأمهات غير المدخنات. بمعنى آخر، الفرضية البديلة تشمل / تدعم جانب واحد من التوزيع. نطلق على ذلك **الفرضية البديلة من جانب واحد One-sided Alternative Hypothesis**. بشكل عام، نستخدم هذا النوع من الفرضيات البديلة إذا كان لدينا سبب مقنع بأنه لا يمكن أن نرى متوسط وزن لمواليد من أمهات مدخنات أعلى.

لرسم البيانات، قمنا بإنشاء مدرج تكراري لوزن المواليد من الأمهات المدخنات وغير المدخنات:

```python
import matplotlib.pyplot as plt

plt.figure(figsize=(9, 6))
smokers_hist = (baby.loc[baby["Maternal Smoker"], "Birth Weight"]
                .hist(density=True, alpha=0.8, label="Maternal Smoker"))
non_smokers_hist = (baby.loc[~baby["Maternal Smoker"], "Birth Weight"]
                    .hist(density=True, alpha=0.8, label="Not Maternal Smoker"))
smokers_hist.set_xlabel("Baby Birth Weights")
smokers_hist.set_ylabel("Proportion per Unit")
smokers_hist.set_title("Distribution of Birth Weights")
plt.legend()
plt.show()
```

<p align="center"> 
<img src='{{ site.baseurl }}/img/appendix-b/hyp_introduction_7_0.png'>
</p>

يبدو أن متوسط وزن المواليد من الأمهات المدخنات أقل من وزن المواليد للأمهات غير المدخنات. هل هذا الإختلاف حدث بشكل عشوائي؟ نحاول الإجابة على هذا السؤال بإستخدام اختبار الفرضية.

لإجراء اختبار فرضية، نفترض أن نموذج معين يقوم بتوليد البيانات؛ ثم نسأل أنفسنا، ما هي فرصة أن نرى نتائج متطرفة مثل التي رأيناها؟ إذا كانت فرصة مشاهدة تلك النتائج ضئيلة جداً، فقد لا يكون النموذج الذي افترضناة هو النموذج المثالي.

بشكل خاص، نفترض أن فرضية العدم و نموذج إحتماليتها، **نموذج العدم Null Model**، صحيحان. بمعنى آخر، نفترض أن فرضية العدم صحيحة ونركز على القيمة الإحصائية فيها. نموذج الصدفة يقول أنه لا يوجد هناك أي فرق؛ توزيع العينات في الرسم البياني مختلفة فقط بمحض الصدفة.

## اختبار الإحصائية

في مثالنا، نفترض أن تدخين الأمهات لا يأثر على وزن المواليد (وأن أي فرض نطلع عليه حدث بالصدفة). من أجل الأختيار بين فرضياتنا، سنستخدم الفرق بين المجموعتين وتكون **اختبار الإحصائية Test Statistic**. اختبار الإحصائية هو:

$$
\mu_{\text{smoking}} - \mu_{\text{non-smoking}}
$$

إذاً القيم الصغرى (وهي، القيم السلبية الأعلى) لهذة الإحصائية ستفضل الفرضية البديلة. لنقوم بحساب اختبار الإحصائية للبيانات التي أطلعنا عليها:

```python
nonsmoker = baby.loc[~baby["Maternal Smoker"], "Birth Weight"]
smoker = baby.loc[baby["Maternal Smoker"], "Birth Weight"]
observed_difference = np.mean(smoker) - np.mean(nonsmoker)
observed_difference
```

```ruby
-9.266142572024918
```

إذا لم يكن هناك أي فرق بين التوزيعين في المجتمع الإحصائي، فإذا كانت الأم مدخنة أو غير مدخنة لن يأثر على متوسط وزن المولود. بمعنى آخر، القيم `True` و `False` في عامود تدخين الأم لن تأثر على المتوسط.

لذا، من أجل محاكاة اختبار الإحصائية في فرضية العدم، يمكننا اعادة خلط اوزان المواليد بشكل عشوائي بين الأمهات: 

```python
def shuffle(series):
    '''
    خلط المصفوفة وأعادة تعين الرقم التسلسلي ليتم إضافة القيمة المختلطة لنفس الرقم
    '''
    return series.sample(frac=1, replace=False).reset_index(drop=True)

baby["Shuffled"] = shuffle(baby["Birth Weight"])
baby
```

**Shuffled**|**Maternal Smoker**|**Birth Weight**| 
:-----:|:-----:|:-----:|:-----:
122|FALSE|120|0
167|FALSE|113|1
115|TRUE|128|2
...|...|...|...
116|TRUE|130|1171
133|FALSE|125|1172
120|FALSE|117|1173

```ruby
1174 rows × 3 columns
```

## اجراء اختبار التبادل

الاختبارات بناءًا على التبادل العشوائي في البيانات يطلق عليها **اختبارات التبادل Permutation Tests**، في الكود البرمجي التالي، سنحاكي الاختبار الإحصائي أكثر من مره ونجمع الفرق في مصفوفة:

```python
differences = np.array([])

repetitions = 5000
for i in np.arange(repetitions):
    baby["Shuffled"] = shuffle(baby["Birth Weight"])

    # اوجد الفرق بالمتوسط بين مجموعتين عشوائيتين
    nonsmoker = baby.loc[~baby["Maternal Smoker"], "Shuffled"]
    smoker = baby.loc[baby["Maternal Smoker"], "Shuffled"]
    simulated_difference = np.mean(smoker) - np.mean(nonsmoker)

    differences = np.append(differences, simulated_difference)
```

نرسم المدرج التكراري للفرق في المتوسطات

```python
differences_df = pd.DataFrame()
differences_df["differences"] = differences
diff_hist = differences_df.loc[:, "differences"].hist(density=True)
diff_hist.set_xlabel("Birth Weight Difference")
diff_hist.set_ylabel("Proportion per Unit")
diff_hist.set_title("Distribution of Birth Weight Differences");
```

<p align="center"> 
<img src='{{ site.baseurl }}/img/appendix-b/hyp_introduction_17_0.png'>
</p>

من المنطقي أن يتمحور توزيع الفرق في المتوسطات حول الرقم 9 بما أن المجموعتين يجب أن يكون لها نفس المتوسط في فرضية العدم.

من أجل ايجاد استنتاجات لاختبار الإحصائية، يجب علينا حساب القيمة الاحتمالية p-value. القيمة الاحتمالية التجريبية للاختبار هي نسبة الفرق في البيانات التي حاكيناها التي كانت مساوية أو اقل من فرق البيانات الحقيقية.

```python
p_value = np.count_nonzero(differences <= observed_difference) / repetitions
p_value
```

```ruby
0.0
```

في بداية اختبار الفرضية عادة ما نختار **قيمة فصل الأهمية Threshold of Significance** (يرمز لها عادة ب $ \alpha $) لقيمة الاحتمالية P-value. اذا كانت قيمة الاحتمالية أقل من قيمة فصل الأهمية، إذا نرفض فرضية العدم. قيم الفصل الأكثر أستخدماً هي 0.01 و 0.05، فيها 0.01 تمثل اكثر "تشدد" كوننا نحتاج إلى أدلة أكثر لصالح الفرضية البديلة لرفض فرضية العدم.

في أي من هذة الحالات، نرفض فرضية العدم بما أن قيمة الاحتمالية اقل من قيمة فصل الأهمية.

## تمهيد فترات الثقة

يحتاج علماء البيانات في كثير من الأحيان لتقدير متغير المجمتع الإحصائي المجهولة باستخدام عينة عشوائية. على الرغم أننا نفضل أخذ عينات كثيرة من المجمتع الإحصائي لإنشاء توزيع للعينات، غالباً ما نكون مقتصرين على عينة واحدة بسبب الوقت والمال.

لحسن الحظ، العينة العشوائية الكبيرة تبدو مشابهه للمجتمع الإحصائي الأصلي. التمهيد Bootstrap يستخدم ذلك لمحاكاة عينات جديدة عن طريق أعادة أخذ العينات من العينة الأصلية.

لتطبيق التمهيد، نقوم بالخطوات التالية:

- أخذ عينة مع بديلة من العينة الأصلية (والتي هي الآن العينة التي تم تمهيدها). هذة العينات يطلق عليها عينات التمهيد. عادة ما نأخذ الآلآف من عينات التمهيد (~10,000).
- حساب الفائدة الإحصائية لكل عينة تمهيدية. يطلق عليها الإحصائية التمهيدية، والتوزيع التجريبي لهذة الإحصائية التمهيدية هي تقريب لتوزيع العينة في الإحصائية التمهيدية.

<p align="center"> 
<img src='{{ site.baseurl }}/img/appendix-b/Bootstrap_25_0.png'>
</p>

قد نستخدم توزيع عينات التمهيد لإنشاء فترات الثقة والتي نستخدمها لتوقع قيمة متغير المجتمع الإحصائي.

بما أن بيانات الوزن عند الولادة توفر عينة عشوائية حجمها كبير، فقد نعمل على البيانات وكأن الأمهات غير المدخنات يمثلون المجتمع الإحصائي لغير المدخنات. بنفس الطريقة، نقول أن البيانات للأمهات المدخنات يمثلون المجتمع الإحصائي للأمهات المدخنات.

لذا، نعام العينة الأصلية كتمهيد المجتمع الإحصائي لنتمكن من القيام بخطوات التمهيد:
- نأخذ عينة مع بديل من الأمهات غير المدخنات ونقوم بحساب متوسط وزن المواليد. نأخذ عينة أخرى مع بديل من الامهات المدخنات ونحسب متوسط وزن المواليد.
- حساب فرق المتوسطات.
- إعادة الخطوات السابقة 10000 مرة، نحصل فيها على 10000 فرق متوسط.

هذة الخطوات تعطينا توزيع تجريبي للعينات للفرق في متوسطات أوزان المواليد:

```python
def resample(sample):
    return np.random.choice(sample, size=len(sample))

def bootstrap(sample, stat, replicates):
    return np.array([
        stat(resample(sample)) for _ in range(replicates)
    ])
nonsmoker = baby.loc[~baby["Maternal Smoker"], "Birth Weight"]
smoker = baby.loc[baby["Maternal Smoker"], "Birth Weight"]

nonsmoker_means = bootstrap(nonsmoker, np.mean, 10000)
smoker_means = bootstrap(smoker, np.mean, 10000)

mean_differences = smoker_means - nonsmoker_means

mean_differences_df = pd.DataFrame()
mean_differences_df["differences"] = np.array(mean_differences)
mean_diff = mean_differences_df.loc[:, "differences"].hist(density=True)
mean_diff.set_xlabel("Birth Weight Difference")
mean_diff.set_ylabel("Proportion per Unit")
mean_diff.set_title("Distribution of Birth Weight Differences");
```

<p align="center"> 
<img src='{{ site.baseurl }}/img/appendix-b/hyp_introduction_28_0.png'>
</p>

أخيراً، لإيجاد فاصل ثقة بنسبة 95% نوجد النسب المئوية ال 2.5 و ال 97.5 في الإحصائية التمهيدية:

```python
(np.percentile(mean_differences, 2.5), 
 np.percentile(mean_differences, 97.5))
```

```ruby
(-11.36909646997882, -7.181670323140913)
```

فاصل الثقة هذا يسمح لنا بالقول بنسبة ثقة 95% أن الفارق في متوسط الأوزان للمواليد المجتمع الإحصائي بين -11.37 و -7.18 أونصة.

## ملخص مراجعة الاستدلال الإحصائي

في هذا الجزء، راجعنا اختبار الفرضيات بإستخدام اختبار التبادل وفاصل الثقة مع التمهيد. للقيام باختبار الفرضية، يجب علينا طرح فرضية العدم والفرضية البديلة، اختيار اختبار الإحصائية المناسب، والقيام بخطوات الاختبار لحساب قيمة الإحتمالية p-value. لإنشاء فاصل ثقة، نختار إختبار إحصاء مناسب، تمهيد العينة الأصلية لإنشاء توزعي تجريبي لاختبار الإحصائية، ونقوم بتحديد الكميات المقابلة لمستوى الثقة الذي لدينا.